{
  "StartAt": "DEREGISTERED",
  "States": {
    "DEREGISTERED": {
      "Type": "Choice",
      "Choices": [
        {
          "Variable": "$.event",
          "StringEquals": "REGISTER_REQUEST",
          "Next": "REGISTERING"
        }
      ],
      "Default": "DEREGISTERED"
    },
    "REGISTERING": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:regionname:function:HandleRegister",
      "Next": "REGISTERED"
      "Catch": [
        {
          "ErrorEquals": ["States.ALL"],
          "Next": "DEREGISTERED"
        }
      ]
    },
    "REGISTERED": {
      "Type": "Choice",
      "Choices": [
        {
          "Variable": "$.event",
          "StringEquals": "DEREGISTER_REQUEST",
          "Next": "DEREGISTERING"
        },
        {
          "Variable": "$.event",
          "StringEquals": "CONNECTION_REQUEST",
          "Next": "CONNECTING"
        },
        {
          "Variable": "$.event",
          "StringEquals": "UPDATE_REGISTER_REQUEST",
          "Next": "REGISTERING"
        },
      ],
      "Default": "REGISTERED"
    },
    "DEREGISTERING": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:regionname:function:HandleDeRegister",
      "Next": "DEREGISTERED"
    },
    "CONNECTING": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:regionname:function:HandleConnectionRequest",
      "Next": "CONNECTED"
      "Catch": [
        {
          "ErrorEquals": ["States.ALL"],
          "Next": "REGISTERED"
        }
      ]
    },
    "CONNECTED": {
      "Type": "Choice",
      "Choices": [
        {
          "Variable": "$.event",
          "StringEquals": "CONNECTION_RELEASE",
          "Next": "CONNECTION_RELEASING"
        }
      ],
      "Default": "CONNECTED"
    }
     "IDLE": {
      "Type": "Choice",
      "Choices": [
       {
          "Variable": "$.event",
          "StringEquals": "SERVICE_REQUEST",
          "Next": "SERVICE_REQUESTED"
        }
      ],
      "Default": "IDLE"
    }
    "CONNECTION_RELEASING": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:regionname:function:HandleConnectionRelease",
      "Next": "IDLE"
    }
     "SERVICE_REQUESTED": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:regionname:function:HandleServiceRequest",
      "Next": "CONNECTED"
      "Catch": [
        {
          "ErrorEquals": ["States.ALL"],
          "Next": "IDLE"
        }
      ]
    }
  }
}
